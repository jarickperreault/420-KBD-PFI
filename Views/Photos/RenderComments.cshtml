@model IEnumerable<KBD_PFI.Models.Comment>
@{
    var user = (KBD_PFI.Models.User)Session["ConnectedUser"];
    if (user == null)
    {
        <div class="alert alert-warning">Veuillez vous connecter pour commenter.</div>
        return;
    }
    int currentPhotoId = (int)Session["currentPhotoId"];
    int currentCommentId = 0;
}
@functions {
    // Placeholder for Helper.ParseContent
    string ParseContent(string content)
    {
        return System.Web.HttpUtility.HtmlEncode(content); // Basic sanitization
    }
    // Placeholder for Helper.When
    string When(DateTime date)
    {
        return date.ToString("dddd dd MMMM yyyy - HH:mm");
    }
}
<div class="commentsLayout">
    @if (Model.Any())
    {
        foreach (var comment in Model)
        {
            currentCommentId = comment.Id;
            var commentOwner = KBD_PFI.Models.DB.Users.Get(comment.OwnerId);
            <div class="commentLayout" commentId="@comment.Id">
                <div class="UserSmallAvatar" style="background-image:url('@(commentOwner?.Avatar ?? "/Content/images/default.jpg")')" title="@(commentOwner?.Name ?? "Unknown")"></div>
                <div class="textComment">@ParseContent(comment.Text)</div>
                <div></div>
                <div class="commentFooter">
                    @When(comment.CreationDate)
                    <div class="commentSubFooter">
                        @if (comment.OwnerId == user.Id)
                        {
                            <i class="editCommentCmd cmdIconSmall fa fa-edit" commentId="@comment.Id" title="Modifier"></i>
                            <i class="deleteCommentCmd cmdIconSmall fa fa-trash" commentId="@comment.Id" title="Supprimer"></i>
                        }
                        <i class="CreateResponseCommentCmd cmdIconSmall fa-regular fa-comment" parentId="@comment.Id" title="Répondre/commenter"></i>
                    </div>
                </div>
            </div>
            <div class="editCommentLayout" id="@comment.Id" userId="@user.Id" ownerId="@comment.OwnerId" style="display:none;">
                <div class="UserSmallAvatar" style="background-image:url('@(commentOwner?.Avatar ?? "/Content/images/default.jpg")')" title="@(commentOwner?.Name ?? "Unknown")"></div>
                <textarea class="form-control" rows="1" placeholder="Modifier">@comment.Text</textarea>
                <div></div>
                <div class="editCommentFooter">
                    <div></div>
                    <span class="updateCommentCmd cmdIconSmall fa fa-check" cmdCommentId="@comment.Id"></span>
                    <span class="abortEditCommentCmd cmdIconSmall fa fa-times" cmdCommentId="@comment.Id"></span>
                </div>
            </div>
            { Html.RenderAction("Comments", "Photos", new { photoId = comment.PhotoId, parentId = comment.Id }); }
            <div class="responseLayout" photoId="@currentPhotoId" createResponseparentId="@currentCommentId" style="display:none;">
                <div class="UserSmallAvatar" style="background-image:url('@(user.Avatar ?? "/Content/images/default.jpg")')" title="@(user.Name ?? "Unknown")"></div>
                <textarea class="form-control" rows="1" placeholder="Répondre"></textarea>
                <div></div>
                <div class="editCommentFooter">
                    <div></div>
                    <span class="createResponseCmd cmdIconSmall fa fa-check" parentId="@currentCommentId"></span>
                    <span class="abortCreateResponseCmd cmdIconSmall fa fa-times" parentId="@currentCommentId"></span>
                </div>
            </div>
        }
    }
    else
    {
        <div class="responseLayout" photoId="@currentPhotoId" createResponseparentId="0" style="display:none;">
            <div class="UserSmallAvatar" style="background-image:url('@(user.Avatar ?? "/Content/images/default.jpg")')" title="@(user.Name ?? "Unknown")"></div>
            <textarea class="form-control" rows="1" placeholder="Commenter"></textarea>
            <div></div>
            <div class="editCommentFooter">
                <div></div>
                <span class="createResponseCmd cmdIconSmall fa fa-check" parentId="0"></span>
                <span class="abortCreateResponseCmd cmdIconSmall fa fa-times" parentId="0"></span>
            </div>
        </div>
    }
</div>